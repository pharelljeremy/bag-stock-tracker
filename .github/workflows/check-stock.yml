name: Bag Stock Alert

on:
  schedule:
    # Every 2 hours
    - cron: '0 */2 * * *'
  workflow_dispatch:

jobs:
  check:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install dependencies
      run: |
        pip install playwright
        playwright install chromium

    - name: Check stock (alerts only when available)
      run: |
        python <<'PYTHON'
        from playwright.sync_api import sync_playwright
        from datetime import datetime
        import sys

        URL = "https://bash.com/ff-mini-bucket-bag-sage-green-000003aclz9/p?skuId=2825852"

        print("="*50)
        print("ðŸ‘œ STOCK CHECK")
        print(datetime.now().strftime("%Y-%m-%d %H:%M:%S"))
        print(URL)
        print("="*50)

        try:
            with sync_playwright() as p:
                browser = p.chromium.launch(headless=True)
                page = browser.new_page()
                page.goto(URL, timeout=15000)
                btn = page.query_selector("#addToCartBtn")

                if not btn:
                    print("ðŸš¨ Add-to-cart button missing")
                    sys.exit(1)

                text = btn.inner_text().strip()
                print(f"ðŸ” Button text: '{text}'")

                if text.lower() != "add to cart":
                    print("ðŸš¨ðŸš¨ STATUS CHANGED â€” POSSIBLE STOCK CHANGE ðŸš¨ðŸš¨")
                    sys.exit(1)
                else:
                    print("âœ… Still normal (Add to cart)")
                    sys.exit(0)

        except Exception as e:
            print("âš ï¸ Error:", e)
            sys.exit(0)
        PYTHON

